  <TestCase name="getExecPlan[q62]">
    <Resource name="sql">
      <![CDATA[/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

-- start query 1 in stream 0 using template query62.tpl and seed 1819994127
select  
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,web_name
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk <= 30 ) then 1 else 0 end)  as `30 days` 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 30) and 
                 (ws_ship_date_sk - ws_sold_date_sk <= 60) then 1 else 0 end )  as `31-60 days` 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 60) and 
                 (ws_ship_date_sk - ws_sold_date_sk <= 90) then 1 else 0 end)  as `61-90 days` 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk > 90) and
                 (ws_ship_date_sk - ws_sold_date_sk <= 120) then 1 else 0 end)  as `91-120 days` 
  ,sum(case when (ws_ship_date_sk - ws_sold_date_sk  > 120) then 1 else 0 end)  as `>120 days` 
from
   web_sales
  ,warehouse
  ,ship_mode
  ,web_site
  ,date_dim
where
    d_month_seq between 1212 and 1212 + 11
and ws_ship_date_sk   = d_date_sk
and ws_warehouse_sk   = w_warehouse_sk
and ws_ship_mode_sk   = sm_ship_mode_sk
and ws_web_site_sk    = web_site_sk
group by
   substr(w_warehouse_name,1,20)
  ,sm_type
  ,web_name
order by substr(w_warehouse_name,1,20)
        ,sm_type
       ,web_name
limit 100

-- end query 1 in stream 0 using template query62.tpl
]]>
    </Resource>
    <Resource name="ast">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first], dir2=[ASC-nulls-first], fetch=[100])
+- LogicalAggregate(group=[{0, 1, 2}], 30 days=[SUM($3)], 31-60 days=[SUM($4)], 61-90 days=[SUM($5)], 91-120 days=[SUM($6)], >120 days=[SUM($7)])
   +- LogicalProject(EXPR$0=[SUBSTR($36, 1, 20)], sm_type=[$50], web_name=[$58], $f3=[CASE(<=(-($1, $33), 30), 1, 0)], $f4=[CASE(AND(>(-($1, $33), 30), <=(-($1, $33), 60)), 1, 0)], $f5=[CASE(AND(>(-($1, $33), 60), <=(-($1, $33), 90)), 1, 0)], $f6=[CASE(AND(>(-($1, $33), 90), <=(-($1, $33), 120)), 1, 0)], $f7=[CASE(>(-($1, $33), 120), 1, 0)])
      +- LogicalFilter(condition=[AND(>=($83, 1212), <=($83, +(1212, 11)), =($1, $80), =($14, $34), =($13, $48), =($12, $54))])
         +- LogicalJoin(condition=[true], joinType=[inner])
            :- LogicalJoin(condition=[true], joinType=[inner])
            :  :- LogicalJoin(condition=[true], joinType=[inner])
            :  :  :- LogicalJoin(condition=[true], joinType=[inner])
            :  :  :  :- LogicalTableScan(table=[[hive, tpcds_bin_partitioned_orc_10000, web_sales]])
            :  :  :  +- LogicalTableScan(table=[[hive, tpcds_bin_partitioned_orc_10000, warehouse]])
            :  :  +- LogicalTableScan(table=[[hive, tpcds_bin_partitioned_orc_10000, ship_mode]])
            :  +- LogicalTableScan(table=[[hive, tpcds_bin_partitioned_orc_10000, web_site]])
            +- LogicalTableScan(table=[[hive, tpcds_bin_partitioned_orc_10000, date_dim]])
]]>
    </Resource>
    <Resource name="optimized exec plan">
      <![CDATA[
SortLimit(orderBy=[EXPR$0 ASC, sm_type ASC, web_name ASC], offset=[0], fetch=[100], global=[true])
+- Exchange(distribution=[single])
   +- SortLimit(orderBy=[EXPR$0 ASC, sm_type ASC, web_name ASC], offset=[0], fetch=[100], global=[false])
      +- HashAggregate(isMerge=[false], groupBy=[EXPR$0, sm_type, web_name], select=[EXPR$0, sm_type, web_name, SUM($f3) AS 30 days, SUM($f4) AS 31-60 days, SUM($f5) AS 61-90 days, SUM($f6) AS 91-120 days, SUM($f7) AS >120 days])
         +- Exchange(distribution=[hash[EXPR$0, sm_type, web_name]])
            +- Calc(select=[SUBSTR(w_warehouse_name, 1, 20) AS EXPR$0, sm_type, web_name, CASE(((ws_ship_date_sk - ws_sold_date_sk) <= 30), 1, 0) AS $f3, CASE((((ws_ship_date_sk - ws_sold_date_sk) > 30) AND ((ws_ship_date_sk - ws_sold_date_sk) <= 60)), 1, 0) AS $f4, CASE((((ws_ship_date_sk - ws_sold_date_sk) > 60) AND ((ws_ship_date_sk - ws_sold_date_sk) <= 90)), 1, 0) AS $f5, CASE((((ws_ship_date_sk - ws_sold_date_sk) > 90) AND ((ws_ship_date_sk - ws_sold_date_sk) <= 120)), 1, 0) AS $f6, CASE(((ws_ship_date_sk - ws_sold_date_sk) > 120), 1, 0) AS $f7])
               +- HashJoin(joinType=[InnerJoin], where=[(ws_warehouse_sk = w_warehouse_sk)], select=[ws_ship_date_sk, ws_warehouse_sk, ws_sold_date_sk, web_name, sm_type, w_warehouse_sk, w_warehouse_name], isBroadcast=[true], build=[right])
                  :- Calc(select=[ws_ship_date_sk, ws_warehouse_sk, ws_sold_date_sk, web_name, sm_type])
                  :  +- HashJoin(joinType=[InnerJoin], where=[(ws_ship_mode_sk = sm_ship_mode_sk)], select=[ws_ship_date_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk, web_name, sm_ship_mode_sk, sm_type], isBroadcast=[true], build=[right])
                  :     :- Calc(select=[ws_ship_date_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk, web_name])
                  :     :  +- HashJoin(joinType=[InnerJoin], where=[(ws_web_site_sk = web_site_sk)], select=[ws_ship_date_sk, ws_web_site_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk, web_site_sk, web_name], isBroadcast=[true], build=[right])
                  :     :     :- Calc(select=[ws_ship_date_sk, ws_web_site_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk])
                  :     :     :  +- HashJoin(joinType=[InnerJoin], where=[(ws_ship_date_sk = d_date_sk)], select=[ws_ship_date_sk, ws_web_site_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk, d_date_sk], isBroadcast=[true], build=[right])
                  :     :     :     :- TableSourceScan(table=[[hive, tpcds_bin_partitioned_orc_10000, web_sales, project=[ws_ship_date_sk, ws_web_site_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk]]], fields=[ws_ship_date_sk, ws_web_site_sk, ws_ship_mode_sk, ws_warehouse_sk, ws_sold_date_sk])
                  :     :     :     +- Exchange(distribution=[broadcast])
                  :     :     :        +- Calc(select=[d_date_sk], where=[SEARCH(d_month_seq, Sarg[[1212..1223]])])
                  :     :     :           +- TableSourceScan(table=[[hive, tpcds_bin_partitioned_orc_10000, date_dim, project=[d_date_sk, d_month_seq]]], fields=[d_date_sk, d_month_seq])
                  :     :     +- Exchange(distribution=[broadcast])
                  :     :        +- TableSourceScan(table=[[hive, tpcds_bin_partitioned_orc_10000, web_site, project=[web_site_sk, web_name]]], fields=[web_site_sk, web_name])
                  :     +- Exchange(distribution=[broadcast])
                  :        +- TableSourceScan(table=[[hive, tpcds_bin_partitioned_orc_10000, ship_mode, project=[sm_ship_mode_sk, sm_type]]], fields=[sm_ship_mode_sk, sm_type])
                  +- Exchange(distribution=[broadcast])
                     +- TableSourceScan(table=[[hive, tpcds_bin_partitioned_orc_10000, warehouse, project=[w_warehouse_sk, w_warehouse_name]]], fields=[w_warehouse_sk, w_warehouse_name])
]]>
    </Resource>
  </TestCase>
